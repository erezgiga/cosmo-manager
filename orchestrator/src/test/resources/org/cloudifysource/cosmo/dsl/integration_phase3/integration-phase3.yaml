definitions:

    imports:
        - "cloudify.types"
        - "vagrant-host-provisioner.yaml"
        - "diamond-installer.yaml"

    service_templates:
        simple_web_server:
            topology:
                webserver_host:
                    type: "cloudify.tosca.types.host"
                    properties:
                        install_agent: 'true'
                        vagrant_file: |
                            Vagrant.configure("2") do |config|
                              config.vm.box = "precise32"
                              config.vm.network :private_network, ip: "10.0.0.5"
                              config.vm.provision :shell, :inline => "sudo ufw disable"
                            end
                        worker_config:
                            user: 'vagrant'
                            port: '22'
                            key: '/home/dan/.vagrant.d/insecure_private_key'
                            broker: 'amqp://guest:guest@10.0.0.1:5672//'

                webserver_middleware:
                    type: "cloudify.tosca.types.web_server"
                    properties:
                        diamond_config:
                            # properties for management machine (test machine)
#                            skip_install_dependencies: 'true'
#                            skip_workaround: 'true'

                            workdir: '/home/vagrant'
                            user: 'vagrant'
                            group: 'vagrant'
                            collectors_reload_interval: '3600'
                            riemann_host: '10.0.0.1'
                            riemann_port: '5555'
                            riemann_transport: 'tcp'
                            collectors:
                                celeryd:
                                    meta:
                                        url: 'http://10.0.0.1:53229/celeryd.py'
                                        name: 'CeleryRegisteredTasksCollector'
                                    config:
                                        path: 'celeryd'
                                        broker_url: 'amqp://guest:guest@10.0.0.1:5672//'
                                        interval: '10'
                    relationships:
                        cloudify.tosca.relationships.hosted_on: "webserver_host"
